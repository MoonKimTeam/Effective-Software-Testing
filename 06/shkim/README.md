# 테스트 더블과 모의 객체

<img width="367" alt="스크린샷 2024-06-03 오후 8 10 45" src="https://github.com/MoonKimTeam/Effective-Software-Testing/assets/87420630/8e052b0b-2f00-4f6c-b06a-945945bf2f2c">

데이터베이스와 같은 복잡한 요소를 포함하고 있는 클래스에 의존하는 클래스를 어떻게 테스트해야 할까 ? <br>
우리는 다른 클래스에 의존하는 클래스를 테스트할때 의존성을 사용하지 않는 방법을 알아내야 한다. <br>
이때 **테스트 더블**이 도움이 된다. 우리는 테스트 내에서 이 가짜 구성요소 B를 완전히 제어할 수 있기 때문에, 테스트 맥락에 따라 B처럼 행동하도록 할 수 있다. <br>
다른 객체의 동작을 시뮬레이션하는 객체를 사용하면 다음과 같은 장점이 있다.

- 더 큰 제어권을 가진다.
- 빠르다.
- 클래스 간의 상호작용을 반영할 수 있다.

우리의 목표는 시스템의 다른 단위에 크게 신경쓰지 않고, 단일 단위에 집중하는 것이다.

<br>

## 더미, 페이크, 스텁, 모의 객체, 스파이

- 더미 객체
  - 더미는 테스트 대상 클래스에 전달되지만 절대 사용되지 않는 객체다. 어떤 비즈니스 애플리케이션에 전달해야 할 인수가 여러 개 있지만, 테스트는 이들 중 몇 개만 수행할 떄 흔히 볼 수 있다.
- 페이크 객체
  - 시뮬레이션하는 클래스와 같이 실제로 동작하는 구현체를 가진다. 하지만 똑같이 동작하지는 않고, 훨씬 단순한 방법으로 동작한다.
- 스텁
  - 테스트 과정에서 수행된 호출에 대해 하드 코딩된 응답을 제공한다. 페이크 객체와 달리 실제로 동작하는 구현체가 없다.
- 모의 객체
  - 메서드의 응답을 설정할 수 있다는 점에서 스텁 같은 역할을 한다. 모든 상호작용을 저장해서 나중에 단언문에 활용할 수 있도록 해준다.
- 스파이
  - 의존성을 감시한다. 실제 객체를 감싸서 그 행동을 관찰한다.

<br>

## 현업에서의 모의 객체

### 모의 객체의 단점

어떤 개발자는 모의 객체를 사용하는 것은 테스트 스위트가 **코드가 아니라 모의 객체를 테스트**하도록 만든다고 믿는다. <br>
모의 객체를 사용하면 자연스럽게 테스트를 덜 현실적으로 만든다. 예를 들어 상용 버전에서 클래스끼리 통신하는 방식이 잘못될 수 있는데, 클래스를 모의했기 때문에 그 부분을 놓칠 수도 있다.

또 다른 단점으로, 모의 객체를 사용한 테스트는 자연스럽게 모의 객체를 사용하지 않는 테스트보다 코드와 결합하게 된다. <br>
테스트 대상 클래스에 대한 정보를 너무 많이 알아서, 테스트를 변경하기 힘들어진다. <br>
따라서 테스트를 단순하게 해주지만, 테스트와 제품 코드 간의 결합도를 증가시킨다. <br>
이로 인해 제품 코드를 변경할 때마다 테스트를 변경해야 할 수 있다.

## 모의해야 하는 대상과 하지 말아야 하는 대상

의존성이 다음과 같은 종류일 때 모의 객체나 스텁을 사용한다.

- 의존성이 너무 느린 경우
- 의존성이 외부 인프라와 통신하는 경우
- 의존성을 시뮬레이션 하기 힘든 경우

<br>

반면 다음과 같은 경우 모의 객체나 스텁을 꺼리게 된다.

- 엔티티
- 네이티브 라이브러리나 유틸리티 메서드
- 충분히 단순한 의존성

<br>

## 날짜 및 시간 래퍼

소프트웨어 시스템은 날짜와 시간 정보를 주로 다룬다. 테스트가 어떤 코드를 완전하게 수행하려면 다양한 날짜 및 시간을 입력으로 받을 수 있어야 한다. <br>
날짜 및 시간 연산은 흔하게 일어나기 때문에 전용 클래스로 감싸는게 좋다.









