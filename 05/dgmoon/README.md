# Chapter 05 속성 기반 테스트

속성 기반 테스트: 테스트 대상 속성을 표현만 하고 테스트 프레임워크가 해당하는 일부 테스트 케이스를 선택하여 테스트 수행

구체적인 예를 선택하는 대신 테스트 프레임워크가 프로그램을 깨뜨릴 반례를 찾음

속성 기반 테스트에는 창의성이 필요

## 합격 등급 프로그램

자바의 유명한 속성 기반 테스트 프레임워크 -> jqwik

속성 기반 테스트로 프로그램이 가져야 하는 속성 정의

- fail
- pass
- invalid

단계

1. 테스트 메서드에 @Property 애너테이션 부착
2. String, Integer, List, Date 등 다양한 타입의 무작위 생성 속성 사용
3. 테스트 대상 메서드를 호출하고 메서드 동작이 올바른지 단언
4. 테스트 실행 시 무작위 데이터를 대량으로 생성하고 해당 데이터로 메서드를 호출하여 속성을 깨뜨리는 입력 찾음

- 각 속성(fail, pass, invalid)에 대한 속성 기반 테스트 메서드 작성
- @Test 대신 @Property
- @ForAll - 모든 입력에 대해 해당 속성이 유지되어야 함을 선언
- @FloatRange - float 형 숫자의 범위 설정 가능
- @Provide - 복잡한 입력을 표현해서 생성할 때 사용
- 무작위 등급을 생성하는 메서드인 invalidGrades() - 범위 바깥의 입력을 생성하기 위함
    - @Provide 애너테이션 부착
    - Arbitrary<T>를 반환한다.(T는 생성할 데이터의 타입)
    - Arbitrary.oneOf() - 여러 가지 경우 중 하나를 선택
    - Arbitrary.floats() - 임의의 float 형 숫자 생성

## unique 메서드 테스트

- 배열 요소를 TreeSet에 넣어서 중복을 제거하고 내림차순으로 정렬된 배열을 반환하 메서드
- @Size 입력 값의 크기를 지정(배열의 크기)
- List의 타입 변수 Integer에 @IntRange - 임의의 int 형 숫자 생성
- assertJ의 다양한 단언문 - contains(), doesNotHaveDuplicates(), isSortedAccordingTo()

## indexOf 메서드 테스트

- 배열을 입력받아 지정된 인덱스부터 주어진 값의 위치를 찾는 메서드
- 경계값 테스트, 구조적 테스트, 속성 기반 테스트를 각각 수행하여 보여줌
- 속성 기반 테스트가 다른 테스트 메서드보다 메서드의 속성을 더 다양하게 수행함
- 속성 기반 테스트를 작성하려면 창의성이 필요

## Basket 클래스 테스트

- 장바구니에 Product를 추가하는 add(), 제거하는 remove()
- 숨겨져 있는 버그를 찾기 위해 속성 기반 테스트 수행
- 장바구니에서 발생할 수 있는 다양한 동작을 나타내는 jqwik 액션 만들기
    - 예) 추가, 제거 순서 바꾸기

## 복잡한 도메인 객체 생성

- jqwik의 Combinators API를 사용하여 더 복잡한 도메인 객체 생성하기
- Arbitrary 객체로 각 필드에 대한 임의의 값을 생성
- Combinators.combine() 메서드로 임의의 값들을 조합한 객체 생성

## 현업

### 예시 기반 테스트 vs. 속성 기반 테스트

- 예시 기반 테스트와 속성 기반 테스트를 섞어서 사용하고 항상 속성 기반 테스트를 작성해야 하는 건 아님
- 예시 기반 테스트가 더 단순하고 이해하기 쉬움
- 예시 기반 테스트로 충분하다고 확신할 수 없을 때 사용

### 속성 기반 테스트 문제

- 매우 비용이 많이 들거나 불가능한 데이터 등을 생성하도록 요구하는 것
- 속성의 경계를 올바로 나타내야 함 -> 그렇지 않으면 테스트를 제대로 수행하지 않음
- 메서드에 전달할 입력 데이터가 가능한 모든 옵션 간에 균등하게 분포돼있는지 확인 필요
    - 삼각형 세 변의 길이를 각각 무작위 정숫값으로 생성하도록 하면 유효하지 않은 삼각형이 생성될 가능성이 높아짐
    - 이 경우 테스트를 유효하지 않은 삼각형의 세 변 길이와 유효한 삼각형 세 변 길이로 나눠서 입력 받는 게 좋음

### 창의성이 핵심

속성을 나타내는 방법을 찾고, 임의의 데이터를 생성하고, 구체적인 입력을 모른채로 예상 동작을 단언하는 데는 `창의성`과 `많은 연습` 필요
