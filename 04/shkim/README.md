# 계약 설계

TaxCalculator라는 특정 세금을 계산하는 클래스가 있다고 가정하자. <br>
이 클래스가 수행하는 계산은 양수일때만 가능하다는 요구사항이 있다. <br>
이런 제약사하을 어떻게 모델링하고 싶은지 생각해볼 필요가 있다.

- 클래스가 유효하지 않은 입력으로 다른 클래스를 절대 호출하지 못하도록 한다. TaxCalculator를 호출하는 다른 클래스가 음수를 절대로 전달하지 않도록 하는 방법이다.
- 유효하지 않은 입력이 발생하면 시스템은 중단되고, 사용자에게 에러 메시지를 전달한다.
- 개발 중인 각 클래스에 대해 명확한 계약을 정의한다. 클래스는 사후 조건으로 무엇을 제공하는지, 불변식은 클래스에 대해 항상 무엇을 유지하도록 하는지를 명확하게 설립한다.

## 사전 조건과 사후 조건

세금 계산 예제에서, 메서드가 제대로 동작하도록 하는 **사전 조건**과 메서드가 산출물로 보장하는 **사후 조건**을 고찰할 필요가 있다. <br>
**이 메서드는 사전 조건으로 음수를 받을 수 없고, 사후 조건으로 음수를 반환하지 않는다.**

```java
public class TaxCalculator {
    public double calculateTax(double value) {
        // 사전 조건
        if (value < 0) { 
            throw new RuntimeException("Value cannot be negative");
        }
        
        double taxValue = 0;
        
        // 비즈니스 로직...
        // 비즈니스 로직...
        // 비즈니스 로직...

        // 사후 조건
        if (taxValue < 0) {
            throw new RuntimeException("Calculated tax value cannot be negative");
        }
        
        return taxValue;
    }
}
```


## 불변식

메서드의 사전, 사후 모두의 경우 유지되어야 하는 조건을 **불변식**이라고 한다. <br>
불변식은 어떤 객체나 데이터 구조의 생명 주기 전체에 해당하는 조건을 가진다. <br>
불변식은 메서드 실행 도중 유지되지 않을 수 있지만, 결국에는 불변식이 유지되도록 보장할 필요가 있다.

## 계약 변경과 리스코프 치환 법칙

calculateTax 메서드에 새로운 사전조건이 필요해졌다. <br>
value는 0보다 크거나 같아야 한다 대신 100보다 크거나 같아야 한다로 바꿔야 한다. <br>
이 변경사항은 시스템과 테스트 스위트에 어떤 영향을 끼치는가 ?

<img width="690" alt="스크린샷 2024-05-26 오후 2 13 12" src="https://github.com/MoonKimTeam/Effective-Software-Testing/assets/87420630/06488a6d-ccfc-4f09-b607-267e0038b39a">

변경으로 인한 영향을 파악하는 가장 쉬운 방법은 변경 그 자체를 살펴보거나 변경이 일어난 클래스를 확인하는게 아니라 변경된 클래스를 사용하는 다른 모든 클래스를 살펴보는 것이다. <br>
m2()에는 아무 일이 일어나지 않고, m1()은 깨지고, m3()은 데이터베이스에서 가져온 값에 따라 달라질 것이다.

calculateTax()가 음수를 받도록 사전 조건을 변경해보자. 이 경우에는 세 의존 클래스 모두 망가지지 않는다. <br>
**어떤 대상에 대해 사전 조건을 약화시키거나 덜 제한하면, 변경된 클래스는 클라이언트와 맺은 계약을 깨뜨리지 않는다.**

## 현업에서의 계약에 의한 설계

### 입력 유효성 검사인가, 계약인가 ? 아니면 둘 다인가 ?

**유효성 검사**는 사용자로부터 들어올 수 있는 불량 데이터나 유효하지 않은 데이터가 시스템에 침투하지 않도록 한다. <br>
예를 들면 사용자가 품목 추가 페이지에 있는 수량 필드에 문자를 입력했다면 "수량은 숫자값이어야 합니다"와 같은 메시지를 반환하는 것이다.

**계약**은 클래스간의 의사소통이 문제없이 일어나도록 한다. *(데이터는 이미 유효)*

<img width="623" alt="스크린샷 2024-05-26 오후 2 33 00" src="https://github.com/MoonKimTeam/Effective-Software-Testing/assets/87420630/dff9e91d-a72d-48e9-99f7-1e8bf4c73a08">




















